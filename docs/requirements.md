# Visual Table Canvas for Markdown - 要件定義書

## 概要

VSCode拡張機能として動作し、開いているMarkdownファイル内の表をExcelライクなUIで編集できる機能を提供する。

## 機能概要

### CodeLens連携

- Markdownファイル内の表を検出し、各表の上部に「Edit」リンクをCodeLensで表示する
- ファイル内に複数の表がある場合、それぞれに個別のEditリンクを表示する

### Webview Panel

- Editリンクをクリックすると、Webview PanelでExcelライクなUI編集画面を表示する

---

## 編集UI仕様

### レイアウト

- 列ヘッダー: A, B, C... のアルファベット表記
- 行ヘッダー: 1, 2, 3... の数字表記
- Markdownのヘッダー行も通常行と同等に扱う（特別扱いしない）

### 制限事項

- 行・列の最大数: 各10まで
- セル内のMarkdown書式（太字、リンク等）はプレーンテキストとして編集
- 外部アプリケーション（Excel等）からのコピー＆ペーストは非対応

---

## キーボード・ショートカット

### セル選択モード

| キー | 動作 |
|------|------|
| Tab | 次のセルに移動 |
| Shift + Tab | 前のセルに移動 |
| Enter | 下のセルに移動 |
| 方向キー | 入力した方向キーに応じたセル移動 |
| Ctrl + C | 選択範囲をコピー |
| Ctrl + V | 選択範囲に貼り付け |
| Ctrl + Z | 操作を元に戻す（※アクション単位） |
| Delete | 選択範囲をクリア |
| F2 | セル編集モードに変更 |
| その他のキー | セル編集モードに変更 + 入力したキー値でセルの値を変更 |

### セル編集モード

| キー | 動作 |
|------|------|
| Alt + Enter | セル内で改行 |
| Enter | セル編集を確定 + セル選択モードに変更 |
| Esc | セル選択モードに変更（編集をキャンセル） |

### Undo操作単位（Ctrl + Z）

以下の操作をそれぞれ1つのUndo単位として扱う：

- セル編集の確定（Enter/Tab/クリック等でセルを離れたとき）
- ペースト操作（Ctrl + V）
- 行/列の追加
- 行/列の削除
- セルクリア（Delete）

---

## マウス操作

### セル選択

- セルをクリック: 単一セルを選択
- ドラッグ（例: A1〜C2）: 範囲内のセルを複数選択

### 行・列ヘッダー操作

#### 左クリック

- 行ヘッダーをクリック: 行全体を選択
- 列ヘッダーをクリック: 列全体を選択
- 複数行・複数列の選択も可能

#### 右クリックメニュー

| メニュー項目 | 動作 |
|-------------|------|
| 選択した行/列を削除 | 選択中の行/列を削除（後続の行/列がスライド） |
| コピーした行/列を挿入 | 行/列がコピーされている場合のみ表示。コピーした行/列を挿入 |
| 空行/列を前に挿入 | 何行/列追加するかを入力するUIを表示後、選択位置の前に挿入 |
| 空行/列を後に挿入 | 何行/列追加するかを入力するUIを表示後、選択位置の後に挿入 |

---

## コピー＆ペースト仕様

### 行・列ヘッダー選択時

- Ctrl + C: 選択中の行/列をコピー
- Ctrl + V: コピーした行/列を貼り付け（既存データは上書き）

### セル選択時のペースト動作

| 貼り付け先の選択状態 | コピー元 | 動作 |
|---------------------|----------|------|
| 行/列選択 | 任意 | エラーメッセージを表示し、貼り付けを拒否 |
| 複数セル選択 | 単一セル | コピー元のセル値を選択範囲全体に適用 |
| 単一セル選択 | 複数セル | 選択セルを始点としてコピー元の情報を貼り付け |
| 複数セル選択 | 複数セル（同サイズ） | そのまま貼り付け |
| 複数セル選択 | 複数セル（異サイズ） | エラーメッセージを表示し、貼り付けを拒否 |

---

## 保存機能

### 保存タイミング

- パネルを閉じるときに確認ダイアログを表示

### 保存ロジック

1. Webview Panelの`onDidDispose`イベントを監視
2. 編集開始時の状態と現在の状態を比較して変更を検知
3. 変更がある場合、VSCodeの`showInformationMessage`で「保存しますか？」と確認
4. 「はい」選択時: テーブルデータをMarkdown形式に変換
5. VSCode WorkspaceEdit APIで元のMarkdownファイル内の該当テーブル部分を置換
